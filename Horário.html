 <!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Montar Horário Escolar Avançado</title>
<style>
body { font-family: Arial; margin:0; padding:0; background:#f0f2f5;}
header { background:#2463ff; color:#fff; padding:15px; text-align:center; }
main { display:flex; gap:20px; padding:20px; flex-wrap:wrap;}
section { background:#fff; padding:15px; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,.1);}
#prateleira { width:220px; min-width:220px; }
.item { background:#2463ff; color:#fff; padding:5px; margin:5px 0; border-radius:5px; cursor:grab; display:flex; justify-content:space-between;}
table { border-collapse:collapse; width:100%; }
th, td { border:1px solid #ccc; padding:8px; text-align:center; min-width:80px; height:40px; }
td { background:#fafafa; }
td.dragover { background:#cce5ff; }
.meta { font-size:12px; opacity:0.8;}
</style>
</head>
<body>

<header><h1>Montar Horário Escolar Avançado</h1></header>
<main>
  <!-- Prateleira -->
  <section id="prateleira">
    <h2>Disciplinas</h2>
    <div id="disciplinas"></div>
  </section>

  <!-- Tabela de Horário -->
  <section style="flex:1;">
    <h2>Horário</h2>
    <table id="tabelaHorario">
      <thead>
        <tr>
          <th>Horário</th>
          <th>Segunda</th>
          <th>Terça</th>
          <th>Quarta</th>
          <th>Quinta</th>
          <th>Sexta</th>
        </tr>
      </thead>
      <tbody>
        <tr><td>07:00-08:00</td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td>08:00-09:00</td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td>09:00-10:00</td><td></td><td></td><td></td><td></td><td></td></tr>
      </tbody>
    </table>
  </section>
</main>

<script>
// Dados de exemplo: professor, disciplinas, meta
const professores = [
  {nome:'João', disciplinas:['Matemática'], meta:{'Matemática':3}, count:{'Matemática':0}},
  {nome:'Maria', disciplinas:['Português','História'], meta:{'Português':4,'História':2}, count:{'Português':0,'História':0}},
  {nome:'Carlos', disciplinas:['Física'], meta:{'Física':2}, count:{'Física':0}}
];

// Montar prateleira
const prateleira = document.getElementById('disciplinas');

function atualizarPrateleira(){
  prateleira.innerHTML = '';
  professores.forEach(p=>{
    p.disciplinas.forEach(d=>{
      const div = document.createElement('div');
      div.className='item';
      div.draggable=true;
      div.dataset.professor=p.nome;
      div.dataset.disciplina=d;
      div.innerHTML = `<span>${d} - ${p.nome}</span> <span class="meta">${p.count[d]}/${p.meta[d]}</span>`;
      div.addEventListener('dragstart', dragStart);
      prateleira.appendChild(div);
    });
  });
}

atualizarPrateleira();

// Drag & Drop
let draggedItem = null;

function dragStart(e){
  draggedItem = e.target;
}

const cells = document.querySelectorAll('#tabelaHorario td');
cells.forEach(td=>{
  td.addEventListener('dragover', e=>{ e.preventDefault(); td.classList.add('dragover'); });
  td.addEventListener('dragleave', e=>{ td.classList.remove('dragover'); });
  td.addEventListener('drop', e=>{
    e.preventDefault();
    td.classList.remove('dragover');
    if(!draggedItem) return;
    const professor = draggedItem.dataset.professor;
    const disciplina = draggedItem.dataset.disciplina;
    const profObj = professores.find(p=>p.nome===professor);

    // Verifica meta
    if(profObj.count[disciplina] >= profObj.meta[disciplina]){
      alert(`⚠️ Meta de aulas atingida para ${disciplina} - ${professor}`);
      return;
    }

    // Verifica conflito (professor já em outra célula)
    const conflito = Array.from(cells).some(c=>c.textContent.includes(professor));
    if(td.textContent && td.textContent !== draggedItem.textContent){
      // Se já tem outra aula, devolve contagem do professor antigo
      const partes = td.textContent.split(' - ');
      const discOld = partes[0];
      const profOld = partes[1];
      const profOldObj = professores.find(p=>p.nome===profOld);
      if(profOldObj) { profOldObj.count[discOld]--; }
    }
    if(conflito && (!td.textContent || td.textContent===draggedItem.textContent)){
      alert(`⚠️ Conflito! ${professor} já está em outro horário.`);
      return;
    }

    td.textContent = `${disciplina} - ${professor}`;
    profObj.count[disciplina]++;
    atualizarPrateleira();
    draggedItem = null;
  });
});
</script>

</body>
</html>   

<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema de Criação de Horários</title>
<style>
    body { font-family: Arial, sans-serif; margin:0; padding:0; }
    header { background-color: #4CAF50; color:white; text-align:center; padding:15px; }
    nav { display:flex; justify-content:center; background:#f0f0f0; }
    nav button { padding:10px 20px; margin:5px; cursor:pointer; border:none; background:#ddd; border-radius:5px; }
    nav button.active { background:#4CAF50; color:white; }
    section { display:none; padding:10px; }
    section.active { display:block; }

    /* Prateleira e grade */
    .container { display:flex; flex-wrap: wrap; gap: 20px; }
    .prateleira { flex:1; min-width:250px; border:2px solid #ccc; padding:10px; border-radius:5px; }
    .prateleira h2 { text-align:center; }
    .disciplina { background:#f0f0f0; padding:8px; margin:5px 0; border:1px solid #999; border-radius:3px; cursor:grab; }
    .grade-horario { flex:3; overflow-x:auto; }
    table { width:100%; border-collapse:collapse; min-width:600px; }
    th, td { border:1px solid #ccc; text-align:center; padding:10px; min-width:100px; }
    th { background:#f4f4f4; }
    td { height:60px; vertical-align:middle; }
    td.dragover { background:#d1ffd1; }

    @media(max-width:768px){ .container{flex-direction:column;} }
</style>
</head>
<body>
<header><h1>Sistema de Criação de Horários</h1></header>

<nav>
    <button class="tab-button active" data-target="cadastro">Cadastros</button>
    <button class="tab-button" data-target="horario">Montagem de Horário</button>
</nav>

<section id="cadastro" class="active">
    <h2>Cadastros</h2>
    <div style="display:flex; flex-wrap:wrap; gap:20px;">
        <div style="flex:1; min-width:200px;">
            <h3>Turmas</h3>
            <input type="text" id="nomeTurma" placeholder="Nome da turma">
            <button onclick="adicionarTurma()">Adicionar</button>
            <ul id="listaTurmas"></ul>
        </div>
        <div style="flex:1; min-width:200px;">
            <h3>Disciplinas</h3>
            <input type="text" id="nomeDisciplina" placeholder="Nome da disciplina">
            <input type="number" id="quantidadeAulas" placeholder="Aulas disponíveis" min="1">
            <button onclick="adicionarDisciplina()">Adicionar</button>
            <ul id="listaDisciplinas"></ul>
        </div>
        <div style="flex:1; min-width:200px;">
            <h3>Professores</h3>
            <input type="text" id="nomeProfessor" placeholder="Nome do professor">
            <input type="text" id="disciplinasProfessor" placeholder="Disciplinas (separadas por ,)">
            <button onclick="adicionarProfessor()">Adicionar</button>
            <ul id="listaProfessores"></ul>
        </div>
    </div>
</section>

<section id="horario">
    <h2>Montagem de Horário</h2>
    <div class="container">
        <div class="prateleira" id="prateleira">
            <h2>Prateleira</h2>
        </div>
        <div class="grade-horario">
            <table>
                <thead>
                    <tr>
                        <th>Horário</th>
                        <th>Segunda</th>
                        <th>Terça</th>
                        <th>Quarta</th>
                        <th>Quinta</th>
                        <th>Sexta</th>
                    </tr>
                </thead>
                <tbody>
                    ${[...Array(6)].map((_, i) =>
                        `<tr>
                            <td>${i+1}º Horário</td>
                            <td class="cell" data-day="Segunda"></td>
                            <td class="cell" data-day="Terça"></td>
                            <td class="cell" data-day="Quarta"></td>
                            <td class="cell" data-day="Quinta"></td>
                            <td class="cell" data-day="Sexta"></td>
                        </tr>`
                    ).join('')}
                </tbody>
            </table>
        </div>
    </div>
    <button onclick="salvarHorario()">Salvar Horário</button>
    <button onclick="carregarHorario()">Carregar Horário</button>
</section>

<script>
    // Abas
    const tabButtons = document.querySelectorAll('.tab-button');
    const sections = document.querySelectorAll('section');
    tabButtons.forEach(btn=>{
        btn.addEventListener('click', ()=>{
            tabButtons.forEach(b=>b.classList.remove('active'));
            btn.classList.add('active');
            sections.forEach(s=>s.classList.remove('active'));
            document.getElementById(btn.dataset.target).classList.add('active');
            if(btn.dataset.target==='horario'){ renderPrateleira(); }
        });
    });

    // Dados
    let turmas = [];
    let disciplinas = [];
    let professores = [];

    function adicionarTurma(){
        const nome = document.getElementById('nomeTurma').value.trim();
        if(nome){ turmas.push(nome); atualizarLista('listaTurmas', turmas); document.getElementById('nomeTurma').value=''; }
    }
    function adicionarDisciplina(){
        const nome = document.getElementById('nomeDisciplina').value.trim();
        const qtd = parseInt(document.getElementById('quantidadeAulas').value);
        if(nome && qtd>0){ disciplinas.push({nome, qtd}); atualizarLista('listaDisciplinas', disciplinas.map(d=>`${d.nome} (${d.qtd} aulas)`)); document.getElementById('nomeDisciplina').value=''; document.getElementById('quantidadeAulas').value=''; }
    }
    function adicionarProfessor(){
        const nome = document.getElementById('nomeProfessor').value.trim();
        const disc = document.getElementById('disciplinasProfessor').value.trim();
        if(nome && disc){ professores.push({nome, disciplinas: disc.split(',').map(d=>d.trim())}); atualizarLista('listaProfessores', professores.map(p=>`${p.nome} - ${p.disciplinas.join(', ')}`)); document.getElementById('nomeProfessor').value=''; document.getElementById('disciplinasProfessor').value=''; }
    }
    function atualizarLista(id, arr){
        const ul = document.getElementById(id); ul.innerHTML=''; arr.forEach(item=>{ const li=document.createElement('li'); li.textContent=item; ul.appendChild(li); });
    }

    function renderPrateleira(){
        const prateleira = document.getElementById('prateleira');
        prateleira.querySelectorAll('.disciplina').forEach(d=>d.remove());
        disciplinas.forEach(d=>{
            professores.forEach(p=>{
                if(p.disciplinas.includes(d.nome) && d.qtd>0){
                    const div = document.createElement('div');
                    div.classList.add('disciplina');
                    div.draggable = true;
                    div.dataset.professor = p.nome;
                    div.dataset.nome = d.nome;
                    div.dataset.qtd = d.qtd;
                    div.textContent = `${d.nome} - ${p.nome} (${d.qtd} aulas)`;
                    div.addEventListener('dragstart', e=>{
                        e.dataTransfer.setData('text/plain', JSON.stringify({nome:d.nome, professor:p.nome}));
                    });
                    prateleira.appendChild(div);
                }
            });
        });
        setupDragAndDrop();
    }

    function setupDragAndDrop(){
        const cells = document.querySelectorAll('.cell');
        cells.forEach(cell=>{
            cell.addEventListener('dragover', e=>{ e.preventDefault(); cell.classList.add('dragover'); });
            cell.addEventListener('dragleave', e=>{ cell.classList.remove('dragover'); });
            cell.addEventListener('drop', e=>{
                e.preventDefault();
                cell.classList.remove('dragover');
                const data = JSON.parse(e.dataTransfer.getData('text/plain'));
                if(cell.textContent){ // devolve aula anterior
                    const [nomeAnt, profAnt] = cell.textContent.split(' - ');
                    const discAnt = disciplinas.find(d=>d.nome===nomeAnt.trim());
                    discAnt.qtd+=1;
                }
                const sameTimeCells = Array.from(cells).filter(c=>c.dataset.day===cell.dataset.day);
                const conflict = sameTimeCells.some(c=>c.textContent.includes(data.professor));
                if(conflict){ alert('Conflito: Este professor já está alocado neste horário.'); return; }
                cell.textContent = `${data.nome} - ${data.professor}`;
                const disc = disciplinas.find(d=>d.nome===data.nome);
                disc.qtd -=1;
                renderPrateleira();
            });
        });
    }

    function salvarHorario(){
        const horario = [];
        document.querySelectorAll('.cell').forEach(cell=>{
            horario.push(cell.textContent);
        });
        localStorage.setItem('horario', JSON.stringify(horario));
        localStorage.setItem('disciplinas', JSON.stringify(disciplinas));
        alert('Horário salvo com sucesso!');
    }

    function carregarHorario(){
        const horario = JSON.parse(localStorage.getItem('horario') || '[]');
        const discSalvas = JSON.parse(localStorage.getItem('disciplinas') || '[]');
        if(horario.length && discSalvas.length){
            disciplinas = discSalvas;
            document.querySelectorAll('.cell').forEach((cell,i)=>{
                cell.textContent = horario[i];
            });
            renderPrateleira();
            alert('Horário carregado!');
        }
    }
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Divisão de Mantimentos</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
/* === Reset e Base === */
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:'Roboto', sans-serif; background:#f4f7fa; color:#333; }
header { background:linear-gradient(90deg,#4CAF50,#81C784); color:white; padding:20px; text-align:center; font-size:1.6em; font-weight:700; box-shadow:0 4px 8px rgba(0,0,0,0.1); }
main { max-width:700px; margin:20px auto; padding:15px; background:white; border-radius:10px; box-shadow:0 6px 15px rgba(0,0,0,0.1); }

/* === Abas === */
.tab { display:flex; flex-wrap:wrap; margin-bottom:10px; border-bottom:2px solid #eee; }
.tab button { flex:1; padding:12px; font-weight:600; border:none; cursor:pointer; background:#f0f0f0; transition:.3s; border-radius:8px 8px 0 0; margin-right:2px; }
.tab button.active { background:#4CAF50; color:white; box-shadow:0 -2px 8px rgba(0,0,0,0.15); }

/* === Conteúdo das abas === */
.tabcontent { display:none; animation:fadeIn 0.4s; padding:10px; }
@keyframes fadeIn { from{opacity:0} to{opacity:1} }

/* === Inputs e Botões === */
label { display:block; margin:10px 0 5px; font-weight:500; }
input, select, button { padding:8px 10px; border-radius:6px; border:1px solid #ccc; font-size:0.95em; width:100%; }
button:hover { opacity:0.9; }
.btn { display:inline-block; font-size:0.85em; padding:5px 10px; margin:3px; border:none; border-radius:5px; cursor:pointer; transition:.2s; }
.btn-editar { background:#FFB74D; color:white; }
.btn-excluir { background:#E57373; color:white; }
.btn-gerar { background:#2196F3; color:white; font-weight:600; }

/* === Listas e Tabelas === */
ul { list-style:none; padding-left:0; margin:5px 0; }
li { margin-bottom:5px; }
#consumidores { max-height:150px; overflow-y:auto; border:1px solid #ccc; padding:5px; border-radius:6px; background:#fafafa; }
.saldo-positivo { color:green; font-weight:bold; }
.saldo-negativo { color:red; font-weight:bold; }
table { width:100%; border-collapse: collapse; font-size:0.85em; margin-top:10px; }
table th, table td { border:1px solid #ddd; padding:6px; text-align:left; }
table th { background:#f0f0f0; }
h2,h3 { margin:10px 0 5px; }

/* === Cards de Saldos e Transferências === */
.card { background:#f9f9f9; padding:10px; margin:5px 0; border-left:4px solid #4CAF50; border-radius:6px; }
</style>
</head>
<body>
<header>Divisão de Mantimentos - Elegante</header>
<main>

  <div class="tab">
    <button class="tablinks active" onclick="openTab(event,'professores')">Professores</button>
    <button class="tablinks" onclick="openTab(event,'compras')">Compras</button>
    <button class="tablinks" onclick="openTab(event,'saldos')">Saldos</button>
    <button class="tablinks" onclick="openTab(event,'relatorio')">Relatório</button>
  </div>

  <!-- Aba Professores -->
  <div id="professores" class="tabcontent" style="display:block;">
    <h2>Escolher Grupo</h2>
    <p class="card">Escolha um grupo. Os professores selecionados serão usados em todas as divisões.</p>
    <label><input type="radio" name="grupo" value="A" onclick="selecionarGrupo('A')"> Grupo A (Wanderson, Gu, Cris)</label>
    <label><input type="radio" name="grupo" value="B" onclick="selecionarGrupo('B')"> Grupo B (Gu, Emerson, Galeno)</label>
    
    <h3>Professores selecionados:</h3>
    <ul id="listaProfessores"></ul>
  </div>

  <!-- Aba Compras -->
  <div id="compras" class="tabcontent">
    <h2>Registrar Compra</h2>
    <p class="card">Preencha todos os campos e selecione pelo menos um consumidor. Valores devem ser numéricos.</p>
    <label>Produto: <input id="produto" placeholder="Ex: Arroz"/></label>
    <label>Valor (R$): <input id="valor" type="number" step="0.01" placeholder="Ex: 25.50"/></label>
    <label>Quem comprou: <select id="comprador"></select></label>
    <label>Quem consumiu:</label>
    <div id="consumidores"></div>
    <button class="btn btn-gerar" onclick="addCompra()">Salvar Compra</button>

    <h3>Compras Registradas</h3>
    <div class="list">
      <table id="tabelaCompras">
        <thead>
          <tr>
            <th>Produto</th>
            <th>Valor</th>
            <th>Comprador</th>
            <th>Consumidores</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- Aba Saldos -->
  <div id="saldos" class="tabcontent">
    <h2>Saldos</h2>
    <p class="card">Clique em "Calcular" para ver os saldos e sugestões de acertos.</p>
    <button class="btn btn-gerar" onclick="calcular()">Calcular</button>
    <div id="saldosLista"></div>
    <h3>Sugestão de Acertos</h3>
    <div id="transferencias"></div>
  </div>

  <!-- Aba Relatório -->
  <div id="relatorio" class="tabcontent">
    <h2>Relatório PDF</h2>
    <p class="card">Clique abaixo para gerar PDF com todas as compras, saldos e transferências.</p>
    <button class="btn btn-gerar" onclick="gerarPDF()">Gerar Relatório PDF</button>
  </div>

</main>

<script>
let professores=[], compras=[], editIndex=null;

function openTab(evt, tabName){
  document.querySelectorAll(".tabcontent").forEach(tc=>tc.style.display="none");
  document.querySelectorAll(".tab button").forEach(tb=>tb.classList.remove("active"));
  document.getElementById(tabName).style.display="block";
  evt.currentTarget.classList.add("active");
}

function selecionarGrupo(grupo){
  professores = grupo==="A"?["Wanderson","Gu","Cris"]:["Gu","Emerson","Galeno"];
  atualizarUI();
}

function atualizarUI(){
  document.getElementById("listaProfessores").innerHTML = professores.map(p=>`<li>${p}</li>`).join("");
  document.getElementById("comprador").innerHTML = professores.map(p=>`<option value="${p}">${p}</option>`).join("");
  document.getElementById("consumidores").innerHTML = professores.map(p=>`<label><input type="checkbox" value="${p}">${p}</label>`).join("<br>");
  const tbody=document.querySelector("#tabelaCompras tbody");
  tbody.innerHTML = compras.map((c,i)=>`
    <tr>
      <td>${c.produto}</td>
      <td>${c.valor.toFixed(2)}</td>
      <td>${c.comprador}</td>
      <td>${c.consumidores.join(", ")}</td>
      <td>
        <button class="btn btn-editar" onclick="editarCompra(${i})">Editar</button>
        <button class="btn btn-excluir" onclick="excluirCompra(${i})">Excluir</button>
      </td>
    </tr>`).join("");
}

function addCompra(){
  const produto=document.getElementById("produto").value.trim();
  const valor=parseFloat(document.getElementById("valor").value);
  const comprador=document.getElementById("comprador").value;
  const consumidores=[...document.querySelectorAll("#consumidores input:checked")].map(c=>c.value);
  if(!produto || isNaN(valor) || valor<=0 || !comprador || consumidores.length===0){ alert("Preencha todos os campos corretamente."); return;}
  const compra={produto, valor, comprador, consumidores};
  if(editIndex!==null){ compras[editIndex]=compra; editIndex=null; } else { compras.push(compra); }
  document.getElementById("produto").value=""; document.getElementById("valor").value=""; document.querySelectorAll("#consumidores input").forEach(c=>c.checked=false);
  atualizarUI();
}

function editarCompra(i){
  const c=compras[i];
  document.getElementById("produto").value=c.produto;
  document.getElementById("valor").value=c.valor;
  document.getElementById("comprador").value=c.comprador;
  document.querySelectorAll("#consumidores input").forEach(cb=>cb.checked=c.consumidores.includes(cb.value));
  editIndex=i;
  openTab({currentTarget:document.querySelector(".tab button[onclick*='compras']")},'compras');
}

function excluirCompra(i){ compras.splice(i,1); atualizarUI(); }

function calcular(){
  if(professores.length===0){ alert("Selecione um grupo primeiro."); return;}
  let saldos={}; professores.forEach(p=>saldos[p]=0);
  compras.forEach(c=>{
    const div=c.valor/c.consumidores.length;
    c.consumidores.forEach(p=>saldos[p]-=div);
    saldos[c.comprador]+=c.valor;
  });
  const lista=document.getElementById("saldosLista");
  lista.innerHTML="";
  for(const p of professores){
    const s=saldos[p];
    const div=document.createElement("div");
    div.className="card "+(s>=0?"saldo-positivo":"saldo-negativo");
    div.textContent=`${p}: R$ ${s.toFixed(2)}`;
    lista.appendChild(div);
  }

  // Sugestão de transferências
  const transferencias=[];
  let devedores=professores.filter(p=>saldos[p]<0).map(p=>({p, val:-saldos[p]}));
  let credores=professores.filter(p=>saldos[p]>0).map(p=>({p, val:saldos[p]}));
  for(const d of devedores){
    for(const c of credores){
      if(d.val>0 && c.val>0){
        const v=Math.min(d.val,c.val);
        transferencias.push({de:d.p, para:c.p, valor:v});
        d.val-=v; c.val-=v;
      }
    }
  }
  const tDiv=document.getElementById("transferencias");
  tDiv.innerHTML=transferencias.map(t=>`<div class="card">${t.de} paga R$ ${t.valor.toFixed(2)} para ${t.para}</div>`).join("");
}

function gerarPDF(){
  calcular(); // garante que saldos estão atualizados
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.setFontSize(16); doc.text("Relatório de Mantimentos", 105, 15, {align:"center"});
  let y=30;
  doc.setFontSize(12);
  compras.forEach(c=>{
    doc.text(`${c.produto} - R$ ${c.valor.toFixed(2)} - Comprador: ${c.comprador} - Consumidores: ${c.consumidores.join(", ")}`, 15, y);
    y+=8; if(y>280){ doc.addPage(); y=20; }
  });
  y+=10; doc.text("Saldos:",15,y); y+=8;
  professores.forEach(p=>{
    doc.text(`${p}: R$ ${saldos[p].toFixed(2)}`,15,y); y+=6; if(y>280){ doc.addPage(); y=20; }
  });
  y+=10; doc.text("Transferências Sugeridas:",15,y); y+=8;
  const tDiv=document.getElementById("transferencias");
  [...tDiv.children].forEach(div=>{
    doc.text(div.textContent,15,y); y+=6; if(y>280){ doc.addPage(); y=20; }
  });
  doc.save("relatorio_mantimentos.pdf");
}
</script>
</body>
</html>
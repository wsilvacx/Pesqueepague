<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Divisão de Despesas</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
  * { margin:0; padding:0; box-sizing:border-box; font-family: 'Poppins', sans-serif; }
  body {
    background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 2rem;
  }
  h1 { margin-bottom: 1rem; color: #333; }
  /* Abas */
  .tabs { display: flex; gap: 1rem; margin-bottom: 1rem; }
  .tab { padding: 0.5rem 1rem; border-radius: 8px; background: #ddd; cursor: pointer; transition: 0.3s; }
  .tab.active { background: #6c63ff; color: #fff; }

  .tab-content { width: 100%; max-width: 1000px; }

  .cards-container { display: flex; flex-wrap: wrap; gap: 1rem; }

  .card {
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    padding: 1rem;
    flex: 1 1 200px;
    min-width: 220px;
    transition: transform 0.3s, box-shadow 0.3s;
    display: flex;
    flex-direction: column;
    max-height: 350px;
  }

  .card:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 25px rgba(0,0,0,0.15);
  }

  .card h2 { margin-bottom: 0.5rem; color: #444; }
  .saldo { font-weight: 600; margin-bottom: 0.5rem; color: #666; }
  .compras { flex: 1; overflow-y: auto; padding-right: 0.5rem; }
  .compras::-webkit-scrollbar { width: 6px; }
  .compras::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.2); border-radius: 3px; }
  .compra-item { padding: 0.5rem; margin-bottom: 0.5rem; background: #f0f0f0; border-radius: 8px; font-size: 0.9rem; display: flex; justify-content: space-between; align-items: center; }
  .compra-item button { background:#6c63ff; border:none; color:#fff; padding:0.2rem 0.5rem; border-radius:6px; cursor:pointer; transition:0.3s; }
  .compra-item button:hover { background:#574fd6; }

  /* Botão flutuante */
  .btn-add {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    background: #6c63ff;
    color: #fff;
    border: none;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    font-size: 2rem;
    cursor: pointer;
    box-shadow: 0 6px 15px rgba(0,0,0,0.2);
    transition: background 0.3s;
  }
  .btn-add:hover { background: #574fd6; }

  /* Modal */
  .modal {
    display: none;
    position: fixed;
    top:0; left:0;
    width:100%; height:100%;
    background: rgba(0,0,0,0.5);
    justify-content: center; align-items: center;
    z-index: 100;
  }

  .modal-content {
    background: #fff;
    border-radius: 12px;
    padding: 2rem;
    width: 90%;
    max-width: 400px;
    position: relative;
  }

  .modal-content h3 { margin-bottom: 1rem; color:#333; }
  .modal-content label { display:block; margin-top:1rem; color:#555; }
  .modal-content input, .modal-content select {
    width: 100%; padding:0.5rem; margin-top:0.3rem; border-radius: 6px; border:1px solid #ccc;
  }
  .modal-content button {
    margin-top:1.5rem;
    padding:0.7rem 1rem;
    border:none;
    border-radius:8px;
    background:#6c63ff;
    color:#fff;
    cursor:pointer;
    transition: background 0.3s;
  }
  .modal-content button:hover { background:#574fd6; }
  .close-modal {
    position:absolute;
    top:10px; right:15px;
    cursor:pointer;
    font-size:1.5rem;
    color:#666;
  }

  /* Relatório */
  .relatorio-card {
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    padding: 1rem;
  }
  .relatorio-card h2 { margin-bottom: 1rem; color: #333; }
  #relatorio div { padding: 0.5rem; border-bottom: 1px solid #eee; font-size: 0.95rem; color: #555; }
</style>
</head>
<body>
<h1>Divisão de Despesas</h1>

<div class="tabs">
  <div class="tab active" data-tab="despesas">Despesas</div>
  <div class="tab" data-tab="relatorio">Relatório</div>
</div>

<div class="tab-content">
  <div id="despesasTab">
    <div class="cards-container" id="cardsContainer"></div>
  </div>
  <div id="relatorioTab" style="display:none;">
    <div class="relatorio-card">
      <h2>Resumo Final</h2>
      <div id="relatorio"></div>
    </div>
  </div>
</div>

<!-- Botão flutuante -->
<button class="btn-add" id="btnAdd">+</button>

<!-- Modal de Adicionar/Editar Compra -->
<div class="modal" id="modal">
  <div class="modal-content">
    <span class="close-modal" id="closeModal">&times;</span>
    <h3 id="modalTitle">Adicionar Compra</h3>
    <label for="comprador">Quem comprou:</label>
    <select id="comprador"></select>
    <label for="descricao">Descrição:</label>
    <input type="text" id="descricao">
    <label for="valor">Valor:</label>
    <input type="number" id="valor" step="0.01">
    <label for="participantes">Participantes (Ctrl+Clique para múltiplos):</label>
    <select id="participantes" multiple></select>
    <button id="addCompra">Salvar</button>
  </div>
</div>

<script>
  const professores = ['Alice','Bruno','Carla','Daniel']; 
  let despesas = [];
  let editIndex = null;

  const cardsContainer = document.getElementById('cardsContainer');
  const modal = document.getElementById('modal');
  const btnAdd = document.getElementById('btnAdd');
  const closeModal = document.getElementById('closeModal');
  const compradorSelect = document.getElementById('comprador');
  const participantesSelect = document.getElementById('participantes');
  const descricaoInput = document.getElementById('descricao');
  const valorInput = document.getElementById('valor');
  const addCompraBtn = document.getElementById('addCompra');
  const relatorioDiv = document.getElementById('relatorio');
  const modalTitle = document.getElementById('modalTitle');

  function atualizarCards() {
    cardsContainer.innerHTML = '';
    professores.forEach(prof => {
      const professorDespesas = despesas.filter(d => d.participantes.includes(prof));
      let saldo = 0;
      professorDespesas.forEach(d => {
        const div = d.valor / d.participantes.length;
        if (d.comprador === prof) saldo += d.valor - div;
        else saldo -= div;
      });
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <h2>${prof}</h2>
        <div class="saldo">Saldo: R$ ${saldo.toFixed(2)}</div>
        <div class="compras">
          ${despesas.filter(d => d.participantes.includes(prof)).map((d,i) => `
            <div class="compra-item">
              <span>${d.comprador} comprou ${d.descricao} - R$ ${d.valor.toFixed(2)}</span>
              <button onclick="editarCompra(${i})">Editar</button>
            </div>
          `).join('')}
        </div>
      `;
      cardsContainer.appendChild(card);
    });
  }

  function atualizarRelatorio() {
    relatorioDiv.innerHTML = '';
    professores.forEach(prof => {
      const professorDespesas = despesas.filter(d => d.participantes.includes(prof));
      let saldo = 0;
      professorDespesas.forEach(d => {
        const div = d.valor / d.participantes.length;
        if (d.comprador === prof) saldo += d.valor - div;
        else saldo -= div;
      });
      const status = saldo >= 0 ? `a receber R$ ${saldo.toFixed(2)}` : `a pagar R$ ${Math.abs(saldo).toFixed(2)}`;
      const div = document.createElement('div');
      div.textContent = `${prof} está ${status}`;
      relatorioDiv.appendChild(div);
    });
  }

  function abrirModal() { modal.style.display = 'flex'; }
  function fecharModal() { modal.style.display = 'none'; }

  btnAdd.addEventListener('click', () => { abrirModal(); modalTitle.textContent='Adicionar Compra'; editIndex=null; });
  closeModal.addEventListener('click', fecharModal);
  window.addEventListener('click', e => { if(e.target===modal) fecharModal(); });

  function preencherSelects() {
    compradorSelect.innerHTML = '';
    participantesSelect.innerHTML = '';
    professores.forEach(p => {
      const option = `<option value="${p}">${p}</option>`;
      compradorSelect.innerHTML += option;
      participantesSelect.innerHTML += option;
    });
  }
  preencherSelects();

  addCompraBtn.addEventListener('click', () => {
    const compra = {
      comprador: compradorSelect.value,
      descricao: descricaoInput.value,
      valor: parseFloat(valorInput.value),
      participantes: Array.from(participantesSelect.selectedOptions).map(o => o.value)
    };
    if(editIndex!==null){ despesas[editIndex]=compra; } 
    else { despesas.push(compra); }
    atualizarCards();
    atualizarRelatorio();
    fecharModal();
    descricaoInput.value=''; valorInput.value=''; participantesSelect.selectedIndex=-1;
  });

  window.editarCompra = function(i){
    editIndex = i;
    const d = despesas[i];
    modalTitle.textContent='Editar Compra';
    compradorSelect.value = d.comprador;
    descricaoInput.value = d.descricao;
    valorInput.value = d.valor;
    Array.from(participantesSelect.options).forEach(opt => { opt.selected = d.participantes.includes(opt.value); });
    abrirModal();
  }

  // Abas
  document.querySelectorAll('.tab').forEach(tab => {
    tab.addEventListener('click', () => {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      if(tab.dataset.tab==='despesas'){ document.getElementById('despesasTab').style.display='block'; document.getElementById('relatorioTab').style.display='none'; }
      else{ document.getElementById('despesasTab').style.display='none'; document.getElementById('relatorioTab').style.display='block'; atualizarRelatorio(); }
    });
  });

  atualizarCards();
  atualizarRelatorio();
</script>
</body>
</html>